from mod.divide_files import merge_blocks
from mod.modulo_hash import *
from mod.enc.aes import *

#derive file count from metadata
file_count = 4

iv = b"\x80\xea\xacbU\x01\x0e\tG\\4\xefQ'\x07\x92" # 16 bytes for AES-128
cipher2 = [154813591145766135381307408100320581872727279802381926251921153367959654726445983463789452039725321237307989748816194466520946981165617567414284940369508252295621408568741594522799840574828305266316028435844847717554430653505159371803880804955563452379732319255639691288215912454881397643439142776021647296376, 154813591145766135381307408100320581872727279802381926251921153367959654726445983463789452039725321237307989748816194466520946981165617567414284940369508252295621408568741594522799840574828305266316028435844847717554430653505159371832544096438075429632315831805025786504962431653723928473790005732950465168616, 154813591145766135381307408100320581872727279802381926251921153367959654726445983463789452039725321237307989748816194466520946981165617567414284940369508252295621408568741594522799840574828305266316028435844847717554430653505159371818936348903170200804058868477602103185005968496965568008340122741277851548837]
prime2 = 154813591145766135381307408100320581872727279802381926251921153367959654726445983463789452039725321237307989748816194466520946981165617567414284940369508252295621408568741594522799840574828305266316028435844847717554430653505159371815836799626994815914862273363768236564919004629159198309175554423687355013493
edge_keys = [b"^\x18\x00q\x84\xe0'\x07\xed\xa4E\xb8\xe3D\xff\x11\xb2\xb3\xce\xcfg3*\x9a6\x99\xfe\xcf\xc9=G\xc7", b'\xb8\x19s\xb0\xc1\x91\xd7\xf2\x1eKo\xf4[\xfaf\\\xb2\x93\xe3\xad&f\xc3\x1b\xd8\xc0\xb7\xbd\x98D\x03\xc0', b'p\xb6\x0bw\x1f\x8c\x98C\r0w(!E\xe3\x8eU\x0e\xd5.\xfa\xfe\x99\xab\x80\x9aB\xee\x1aa\x88{']
metadata = 'testing.txt'
edge_input_folder_name = 'edge_encrypt_blocks/'
edge_output_folder_name = 'edge_decrypt_blocks/'
user_output_folder_name = 'dencrypt_blocks/'
'''
#Edge Decrypt Code
for i in range (1,file_count):
    #bytes_K = cipher2[i-1]^prime2
    file_name = 'block{}.bin'.format(i)
    aes_decrypt_file(edge_keys[i-1], iv, edge_input_folder_name, edge_output_folder_name,file_name)
'''
#Pass the edge decrypted files to user 
for i in range (1,file_count):
    int_key = cipher2[i-1]^prime2
    bytes_K = int_key.to_bytes(32, 'big')
    file_name = 'block{}.bin'.format(i)
    print('block keys: ',int_key)
    aes_decrypt_file(bytes_K, iv, edge_output_folder_name, user_output_folder_name,file_name)

merge_blocks(user_output_folder_name,metadata)
#'''